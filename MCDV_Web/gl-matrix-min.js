!function(t,r){"object"==typeof exports?module.exports=r(global):"function"==typeof define&&define.amd?define([],function(){return r(t)}):r(t)}(this,function(t){"use strict";function r(t){return a=t}function n(){return a="undefined"!=typeof Float32Array?Float32Array:Array}var e={};!function(){if("undefined"!=typeof Float32Array){var t=new Float32Array(1),r=new Int32Array(t.buffer);e.invsqrt=function(n){var e=.5*n;t[0]=n;r[0]=1597463007-(r[0]>>1);var a=t[0];return a*(1.5-e*a*a)}}else e.invsqrt=function(t){return 1/Math.sqrt(t)}}();var a=null;n();var u={};u.create=function(t){var r=new a(3);return t?(r[0]=t[0],r[1]=t[1],r[2]=t[2]):r[0]=r[1]=r[2]=0,r},u.createFrom=function(t,r,n){var e=new a(3);return e[0]=t,e[1]=r,e[2]=n,e},u.set=function(t,r){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r},u.equal=function(t,r){return t===r||Math.abs(t[0]-r[0])<1e-6&&Math.abs(t[1]-r[1])<1e-6&&Math.abs(t[2]-r[2])<1e-6},u.add=function(t,r,n){return n&&t!==n?(n[0]=t[0]+r[0],n[1]=t[1]+r[1],n[2]=t[2]+r[2],n):(t[0]+=r[0],t[1]+=r[1],t[2]+=r[2],t)},u.subtract=function(t,r,n){return n&&t!==n?(n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],n):(t[0]-=r[0],t[1]-=r[1],t[2]-=r[2],t)},u.multiply=function(t,r,n){return n&&t!==n?(n[0]=t[0]*r[0],n[1]=t[1]*r[1],n[2]=t[2]*r[2],n):(t[0]*=r[0],t[1]*=r[1],t[2]*=r[2],t)},u.negate=function(t,r){return r||(r=t),r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r},u.scale=function(t,r,n){return n&&t!==n?(n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n):(t[0]*=r,t[1]*=r,t[2]*=r,t)},u.normalize=function(t,r){r||(r=t);var n=t[0],e=t[1],a=t[2],u=Math.sqrt(n*n+e*e+a*a);return u?1===u?(r[0]=n,r[1]=e,r[2]=a,r):(u=1/u,r[0]=n*u,r[1]=e*u,r[2]=a*u,r):(r[0]=0,r[1]=0,r[2]=0,r)},u.cross=function(t,r,n){n||(n=t);var e=t[0],a=t[1],u=t[2],i=r[0],o=r[1],c=r[2];return n[0]=a*c-u*o,n[1]=u*i-e*c,n[2]=e*o-a*i,n},u.length=function(t){var r=t[0],n=t[1],e=t[2];return Math.sqrt(r*r+n*n+e*e)},u.squaredLength=function(t){var r=t[0],n=t[1],e=t[2];return r*r+n*n+e*e},u.dot=function(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]},u.direction=function(t,r,n){n||(n=t);var e=t[0]-r[0],a=t[1]-r[1],u=t[2]-r[2],i=Math.sqrt(e*e+a*a+u*u);return i?(i=1/i,n[0]=e*i,n[1]=a*i,n[2]=u*i,n):(n[0]=0,n[1]=0,n[2]=0,n)},u.lerp=function(t,r,n,e){return e||(e=t),e[0]=t[0]+n*(r[0]-t[0]),e[1]=t[1]+n*(r[1]-t[1]),e[2]=t[2]+n*(r[2]-t[2]),e},u.dist=function(t,r){var n=r[0]-t[0],e=r[1]-t[1],a=r[2]-t[2];return Math.sqrt(n*n+e*e+a*a)};var i=null,o=new a(4);u.unproject=function(t,r,n,e,a){a||(a=t),i||(i=h.create());var u=i,c=o;return c[0]=2*(t[0]-e[0])/e[2]-1,c[1]=2*(t[1]-e[1])/e[3]-1,c[2]=2*t[2]-1,c[3]=1,h.multiply(n,r,u),h.inverse(u)?(h.multiplyVec4(u,c),0===c[3]?null:(a[0]=c[0]/c[3],a[1]=c[1]/c[3],a[2]=c[2]/c[3],a)):null};var c=u.createFrom(1,0,0),f=u.createFrom(0,1,0),s=u.createFrom(0,0,1),v=u.create();u.rotationTo=function(t,r,n){n||(n=l.create());var e=u.dot(t,r),a=v;if(e>=1)l.set(m,n);else if(e<1e-6-1)u.cross(c,t,a),u.length(a)<1e-6&&u.cross(f,t,a),u.length(a)<1e-6&&u.cross(s,t,a),u.normalize(a),l.fromAngleAxis(Math.PI,a,n);else{var i=Math.sqrt(2*(1+e)),o=1/i;u.cross(t,r,a),n[0]=a[0]*o,n[1]=a[1]*o,n[2]=a[2]*o,n[3]=.5*i,l.normalize(n)}return n[3]>1?n[3]=1:n[3]<-1&&(n[3]=-1),n},u.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+"]"};var M={};M.create=function(t){var r=new a(9);return t?(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8]):r[0]=r[1]=r[2]=r[3]=r[4]=r[5]=r[6]=r[7]=r[8]=0,r},M.createFrom=function(t,r,n,e,u,i,o,c,f){var s=new a(9);return s[0]=t,s[1]=r,s[2]=n,s[3]=e,s[4]=u,s[5]=i,s[6]=o,s[7]=c,s[8]=f,s},M.determinant=function(t){var r=t[0],n=t[1],e=t[2],a=t[3],u=t[4],i=t[5],o=t[6],c=t[7],f=t[8];return r*(f*u-i*c)+n*(-f*a+i*o)+e*(c*a-u*o)},M.inverse=function(t,r){var n,e=t[0],a=t[1],u=t[2],i=t[3],o=t[4],c=t[5],f=t[6],s=t[7],v=t[8],h=v*o-c*s,l=-v*i+c*f,m=s*i-o*f,b=e*h+a*l+u*m;return b?(n=1/b,r||(r=M.create()),r[0]=h*n,r[1]=(-v*a+u*s)*n,r[2]=(c*a-u*o)*n,r[3]=l*n,r[4]=(v*e-u*f)*n,r[5]=(-c*e+u*i)*n,r[6]=m*n,r[7]=(-s*e+a*f)*n,r[8]=(o*e-a*i)*n,r):null},M.multiply=function(t,r,n){n||(n=t);var e=t[0],a=t[1],u=t[2],i=t[3],o=t[4],c=t[5],f=t[6],s=t[7],v=t[8],M=r[0],h=r[1],l=r[2],m=r[3],b=r[4],y=r[5],d=r[6],p=r[7],q=r[8];return n[0]=M*e+h*i+l*f,n[1]=M*a+h*o+l*s,n[2]=M*u+h*c+l*v,n[3]=m*e+b*i+y*f,n[4]=m*a+b*o+y*s,n[5]=m*u+b*c+y*v,n[6]=d*e+p*i+q*f,n[7]=d*a+p*o+q*s,n[8]=d*u+p*c+q*v,n},M.multiplyVec2=function(t,r,n){n||(n=r);var e=r[0],a=r[1];return n[0]=e*t[0]+a*t[3]+t[6],n[1]=e*t[1]+a*t[4]+t[7],n},M.multiplyVec3=function(t,r,n){n||(n=r);var e=r[0],a=r[1],u=r[2];return n[0]=e*t[0]+a*t[3]+u*t[6],n[1]=e*t[1]+a*t[4]+u*t[7],n[2]=e*t[2]+a*t[5]+u*t[8],n},M.set=function(t,r){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r},M.equal=function(t,r){return t===r||Math.abs(t[0]-r[0])<1e-6&&Math.abs(t[1]-r[1])<1e-6&&Math.abs(t[2]-r[2])<1e-6&&Math.abs(t[3]-r[3])<1e-6&&Math.abs(t[4]-r[4])<1e-6&&Math.abs(t[5]-r[5])<1e-6&&Math.abs(t[6]-r[6])<1e-6&&Math.abs(t[7]-r[7])<1e-6&&Math.abs(t[8]-r[8])<1e-6},M.identity=function(t){return t||(t=M.create()),t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},M.transpose=function(t,r){if(!r||t===r){var n=t[1],e=t[2],a=t[5];return t[1]=t[3],t[2]=t[6],t[3]=n,t[5]=t[7],t[6]=e,t[7]=a,t}return r[0]=t[0],r[1]=t[3],r[2]=t[6],r[3]=t[1],r[4]=t[4],r[5]=t[7],r[6]=t[2],r[7]=t[5],r[8]=t[8],r},M.toMat4=function(t,r){return r||(r=h.create()),r[15]=1,r[14]=0,r[13]=0,r[12]=0,r[11]=0,r[10]=t[8],r[9]=t[7],r[8]=t[6],r[7]=0,r[6]=t[5],r[5]=t[4],r[4]=t[3],r[3]=0,r[2]=t[2],r[1]=t[1],r[0]=t[0],r},M.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+"]"};var h={};h.create=function(t){var r=new a(16);return t&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r},h.createFrom=function(t,r,n,e,u,i,o,c,f,s,v,M,h,l,m,b){var y=new a(16);return y[0]=t,y[1]=r,y[2]=n,y[3]=e,y[4]=u,y[5]=i,y[6]=o,y[7]=c,y[8]=f,y[9]=s,y[10]=v,y[11]=M,y[12]=h,y[13]=l,y[14]=m,y[15]=b,y},h.set=function(t,r){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},h.equal=function(t,r){return t===r||Math.abs(t[0]-r[0])<1e-6&&Math.abs(t[1]-r[1])<1e-6&&Math.abs(t[2]-r[2])<1e-6&&Math.abs(t[3]-r[3])<1e-6&&Math.abs(t[4]-r[4])<1e-6&&Math.abs(t[5]-r[5])<1e-6&&Math.abs(t[6]-r[6])<1e-6&&Math.abs(t[7]-r[7])<1e-6&&Math.abs(t[8]-r[8])<1e-6&&Math.abs(t[9]-r[9])<1e-6&&Math.abs(t[10]-r[10])<1e-6&&Math.abs(t[11]-r[11])<1e-6&&Math.abs(t[12]-r[12])<1e-6&&Math.abs(t[13]-r[13])<1e-6&&Math.abs(t[14]-r[14])<1e-6&&Math.abs(t[15]-r[15])<1e-6},h.identity=function(t){return t||(t=h.create()),t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},h.transpose=function(t,r){if(!r||t===r){var n=t[1],e=t[2],a=t[3],u=t[6],i=t[7],o=t[11];return t[1]=t[4],t[2]=t[8],t[3]=t[12],t[4]=n,t[6]=t[9],t[7]=t[13],t[8]=e,t[9]=u,t[11]=t[14],t[12]=a,t[13]=i,t[14]=o,t}return r[0]=t[0],r[1]=t[4],r[2]=t[8],r[3]=t[12],r[4]=t[1],r[5]=t[5],r[6]=t[9],r[7]=t[13],r[8]=t[2],r[9]=t[6],r[10]=t[10],r[11]=t[14],r[12]=t[3],r[13]=t[7],r[14]=t[11],r[15]=t[15],r},h.determinant=function(t){var r=t[0],n=t[1],e=t[2],a=t[3],u=t[4],i=t[5],o=t[6],c=t[7],f=t[8],s=t[9],v=t[10],M=t[11],h=t[12],l=t[13],m=t[14],b=t[15];return h*s*o*a-f*l*o*a-h*i*v*a+u*l*v*a+f*i*m*a-u*s*m*a-h*s*e*c+f*l*e*c+h*n*v*c-r*l*v*c-f*n*m*c+r*s*m*c+h*i*e*M-u*l*e*M-h*n*o*M+r*l*o*M+u*n*m*M-r*i*m*M-f*i*e*b+u*s*e*b+f*n*o*b-r*s*o*b-u*n*v*b+r*i*v*b},h.inverse=function(t,r){r||(r=t);var n,e=t[0],a=t[1],u=t[2],i=t[3],o=t[4],c=t[5],f=t[6],s=t[7],v=t[8],M=t[9],h=t[10],l=t[11],m=t[12],b=t[13],y=t[14],d=t[15],p=e*c-a*o,q=e*f-u*o,A=e*s-i*o,g=a*f-u*c,x=a*s-i*c,w=u*s-i*f,F=v*b-M*m,T=v*y-h*m,R=v*d-l*m,V=M*y-h*b,z=M*d-l*b,I=h*d-l*y,j=p*I-q*z+A*V+g*R-x*T+w*F;return j?(n=1/j,r[0]=(c*I-f*z+s*V)*n,r[1]=(-a*I+u*z-i*V)*n,r[2]=(b*w-y*x+d*g)*n,r[3]=(-M*w+h*x-l*g)*n,r[4]=(-o*I+f*R-s*T)*n,r[5]=(e*I-u*R+i*T)*n,r[6]=(-m*w+y*A-d*q)*n,r[7]=(v*w-h*A+l*q)*n,r[8]=(o*z-c*R+s*F)*n,r[9]=(-e*z+a*R-i*F)*n,r[10]=(m*x-b*A+d*p)*n,r[11]=(-v*x+M*A-l*p)*n,r[12]=(-o*V+c*T-f*F)*n,r[13]=(e*V-a*T+u*F)*n,r[14]=(-m*g+b*q-y*p)*n,r[15]=(v*g-M*q+h*p)*n,r):null},h.toRotationMat=function(t,r){return r||(r=h.create()),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},h.toMat3=function(t,r){return r||(r=M.create()),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[4],r[4]=t[5],r[5]=t[6],r[6]=t[8],r[7]=t[9],r[8]=t[10],r},h.toInverseMat3=function(t,r){var n,e=t[0],a=t[1],u=t[2],i=t[4],o=t[5],c=t[6],f=t[8],s=t[9],v=t[10],h=v*o-c*s,l=-v*i+c*f,m=s*i-o*f,b=e*h+a*l+u*m;return b?(n=1/b,r||(r=M.create()),r[0]=h*n,r[1]=(-v*a+u*s)*n,r[2]=(c*a-u*o)*n,r[3]=l*n,r[4]=(v*e-u*f)*n,r[5]=(-c*e+u*i)*n,r[6]=m*n,r[7]=(-s*e+a*f)*n,r[8]=(o*e-a*i)*n,r):null},h.multiply=function(t,r,n){n||(n=t);var e=t[0],a=t[1],u=t[2],i=t[3],o=t[4],c=t[5],f=t[6],s=t[7],v=t[8],M=t[9],h=t[10],l=t[11],m=t[12],b=t[13],y=t[14],d=t[15],p=r[0],q=r[1],A=r[2],g=r[3];return n[0]=p*e+q*o+A*v+g*m,n[1]=p*a+q*c+A*M+g*b,n[2]=p*u+q*f+A*h+g*y,n[3]=p*i+q*s+A*l+g*d,p=r[4],q=r[5],A=r[6],g=r[7],n[4]=p*e+q*o+A*v+g*m,n[5]=p*a+q*c+A*M+g*b,n[6]=p*u+q*f+A*h+g*y,n[7]=p*i+q*s+A*l+g*d,p=r[8],q=r[9],A=r[10],g=r[11],n[8]=p*e+q*o+A*v+g*m,n[9]=p*a+q*c+A*M+g*b,n[10]=p*u+q*f+A*h+g*y,n[11]=p*i+q*s+A*l+g*d,p=r[12],q=r[13],A=r[14],g=r[15],n[12]=p*e+q*o+A*v+g*m,n[13]=p*a+q*c+A*M+g*b,n[14]=p*u+q*f+A*h+g*y,n[15]=p*i+q*s+A*l+g*d,n},h.multiplyVec3=function(t,r,n){n||(n=r);var e=r[0],a=r[1],u=r[2];return n[0]=t[0]*e+t[4]*a+t[8]*u+t[12],n[1]=t[1]*e+t[5]*a+t[9]*u+t[13],n[2]=t[2]*e+t[6]*a+t[10]*u+t[14],n},h.multiplyVec4=function(t,r,n){n||(n=r);var e=r[0],a=r[1],u=r[2],i=r[3];return n[0]=t[0]*e+t[4]*a+t[8]*u+t[12]*i,n[1]=t[1]*e+t[5]*a+t[9]*u+t[13]*i,n[2]=t[2]*e+t[6]*a+t[10]*u+t[14]*i,n[3]=t[3]*e+t[7]*a+t[11]*u+t[15]*i,n},h.translate=function(t,r,n){var e,a,u,i,o,c,f,s,v,M,h,l,m=r[0],b=r[1],y=r[2];return n&&t!==n?(e=t[0],a=t[1],u=t[2],i=t[3],o=t[4],c=t[5],f=t[6],s=t[7],v=t[8],M=t[9],h=t[10],l=t[11],n[0]=e,n[1]=a,n[2]=u,n[3]=i,n[4]=o,n[5]=c,n[6]=f,n[7]=s,n[8]=v,n[9]=M,n[10]=h,n[11]=l,n[12]=e*m+o*b+v*y+t[12],n[13]=a*m+c*b+M*y+t[13],n[14]=u*m+f*b+h*y+t[14],n[15]=i*m+s*b+l*y+t[15],n):(t[12]=t[0]*m+t[4]*b+t[8]*y+t[12],t[13]=t[1]*m+t[5]*b+t[9]*y+t[13],t[14]=t[2]*m+t[6]*b+t[10]*y+t[14],t[15]=t[3]*m+t[7]*b+t[11]*y+t[15],t)},h.scale=function(t,r,n){var e=r[0],a=r[1],u=r[2];return n&&t!==n?(n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n[3]=t[3]*e,n[4]=t[4]*a,n[5]=t[5]*a,n[6]=t[6]*a,n[7]=t[7]*a,n[8]=t[8]*u,n[9]=t[9]*u,n[10]=t[10]*u,n[11]=t[11]*u,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n):(t[0]*=e,t[1]*=e,t[2]*=e,t[3]*=e,t[4]*=a,t[5]*=a,t[6]*=a,t[7]*=a,t[8]*=u,t[9]*=u,t[10]*=u,t[11]*=u,t)},h.rotate=function(t,r,n,e){var a,u,i,o,c,f,s,v,M,h,l,m,b,y,d,p,q,A,g,x,w,F,T,R,V=n[0],z=n[1],I=n[2],j=Math.sqrt(V*V+z*z+I*I);return j?(1!==j&&(V*=j=1/j,z*=j,I*=j),a=Math.sin(r),u=Math.cos(r),i=1-u,o=t[0],c=t[1],f=t[2],s=t[3],v=t[4],M=t[5],h=t[6],l=t[7],m=t[8],b=t[9],y=t[10],d=t[11],p=V*V*i+u,q=z*V*i+I*a,A=I*V*i-z*a,g=V*z*i-I*a,x=z*z*i+u,w=I*z*i+V*a,F=V*I*i+z*a,T=z*I*i-V*a,R=I*I*i+u,e?t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]):e=t,e[0]=o*p+v*q+m*A,e[1]=c*p+M*q+b*A,e[2]=f*p+h*q+y*A,e[3]=s*p+l*q+d*A,e[4]=o*g+v*x+m*w,e[5]=c*g+M*x+b*w,e[6]=f*g+h*x+y*w,e[7]=s*g+l*x+d*w,e[8]=o*F+v*T+m*R,e[9]=c*F+M*T+b*R,e[10]=f*F+h*T+y*R,e[11]=s*F+l*T+d*R,e):null},h.rotateX=function(t,r,n){var e=Math.sin(r),a=Math.cos(r),u=t[4],i=t[5],o=t[6],c=t[7],f=t[8],s=t[9],v=t[10],M=t[11];return n?t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]):n=t,n[4]=u*a+f*e,n[5]=i*a+s*e,n[6]=o*a+v*e,n[7]=c*a+M*e,n[8]=u*-e+f*a,n[9]=i*-e+s*a,n[10]=o*-e+v*a,n[11]=c*-e+M*a,n},h.rotateY=function(t,r,n){var e=Math.sin(r),a=Math.cos(r),u=t[0],i=t[1],o=t[2],c=t[3],f=t[8],s=t[9],v=t[10],M=t[11];return n?t!==n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]):n=t,n[0]=u*a+f*-e,n[1]=i*a+s*-e,n[2]=o*a+v*-e,n[3]=c*a+M*-e,n[8]=u*e+f*a,n[9]=i*e+s*a,n[10]=o*e+v*a,n[11]=c*e+M*a,n},h.rotateZ=function(t,r,n){var e=Math.sin(r),a=Math.cos(r),u=t[0],i=t[1],o=t[2],c=t[3],f=t[4],s=t[5],v=t[6],M=t[7];return n?t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]):n=t,n[0]=u*a+f*e,n[1]=i*a+s*e,n[2]=o*a+v*e,n[3]=c*a+M*e,n[4]=u*-e+f*a,n[5]=i*-e+s*a,n[6]=o*-e+v*a,n[7]=c*-e+M*a,n},h.frustum=function(t,r,n,e,a,u,i){i||(i=h.create());var o=r-t,c=e-n,f=u-a;return i[0]=2*a/o,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2*a/c,i[6]=0,i[7]=0,i[8]=(r+t)/o,i[9]=(e+n)/c,i[10]=-(u+a)/f,i[11]=-1,i[12]=0,i[13]=0,i[14]=-u*a*2/f,i[15]=0,i},h.perspective=function(t,r,n,e,a){var u=n*Math.tan(t*Math.PI/360),i=u*r;return h.frustum(-i,i,-u,u,n,e,a)},h.ortho=function(t,r,n,e,a,u,i){i||(i=h.create());var o=r-t,c=e-n,f=u-a;return i[0]=2/o,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2/c,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=-2/f,i[11]=0,i[12]=-(t+r)/o,i[13]=-(e+n)/c,i[14]=-(u+a)/f,i[15]=1,i},h.lookAt=function(t,r,n,e){e||(e=h.create());var a,u,i,o,c,f,s,v,M,l,m=t[0],b=t[1],y=t[2],d=n[0],p=n[1],q=n[2],A=r[0],g=r[1],x=r[2];return m===A&&b===g&&y===x?h.identity(e):(s=m-A,v=b-g,M=y-x,l=1/Math.sqrt(s*s+v*v+M*M),s*=l,v*=l,M*=l,a=p*M-q*v,u=q*s-d*M,i=d*v-p*s,l=Math.sqrt(a*a+u*u+i*i),l?(a*=l=1/l,u*=l,i*=l):(a=0,u=0,i=0),o=v*i-M*u,c=M*a-s*i,f=s*u-v*a,l=Math.sqrt(o*o+c*c+f*f),l?(o*=l=1/l,c*=l,f*=l):(o=0,c=0,f=0),e[0]=a,e[1]=o,e[2]=s,e[3]=0,e[4]=u,e[5]=c,e[6]=v,e[7]=0,e[8]=i,e[9]=f,e[10]=M,e[11]=0,e[12]=-(a*m+u*b+i*y),e[13]=-(o*m+c*b+f*y),e[14]=-(s*m+v*b+M*y),e[15]=1,e)},h.fromRotationTranslation=function(t,r,n){n||(n=h.create());var e=t[0],a=t[1],u=t[2],i=t[3],o=e+e,c=a+a,f=u+u,s=e*o,v=e*c,M=e*f,l=a*c,m=a*f,b=u*f,y=i*o,d=i*c,p=i*f;return n[0]=1-(l+b),n[1]=v+p,n[2]=M-d,n[3]=0,n[4]=v-p,n[5]=1-(s+b),n[6]=m+y,n[7]=0,n[8]=M+d,n[9]=m-y,n[10]=1-(s+l),n[11]=0,n[12]=r[0],n[13]=r[1],n[14]=r[2],n[15]=1,n},h.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+"]"};var l={};l.create=function(t){var r=new a(4);return t?(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3]):r[0]=r[1]=r[2]=r[3]=0,r},l.createFrom=function(t,r,n,e){var u=new a(4);return u[0]=t,u[1]=r,u[2]=n,u[3]=e,u},l.set=function(t,r){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r},l.equal=function(t,r){return t===r||Math.abs(t[0]-r[0])<1e-6&&Math.abs(t[1]-r[1])<1e-6&&Math.abs(t[2]-r[2])<1e-6&&Math.abs(t[3]-r[3])<1e-6},l.identity=function(t){return t||(t=l.create()),t[0]=0,t[1]=0,t[2]=0,t[3]=1,t};var m=l.identity();l.calculateW=function(t,r){var n=t[0],e=t[1],a=t[2];return r&&t!==r?(r[0]=n,r[1]=e,r[2]=a,r[3]=-Math.sqrt(Math.abs(1-n*n-e*e-a*a)),r):(t[3]=-Math.sqrt(Math.abs(1-n*n-e*e-a*a)),t)},l.dot=function(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]+t[3]*r[3]},l.inverse=function(t,r){var n=t[0],e=t[1],a=t[2],u=t[3],i=n*n+e*e+a*a+u*u,o=i?1/i:0;return r&&t!==r?(r[0]=-t[0]*o,r[1]=-t[1]*o,r[2]=-t[2]*o,r[3]=t[3]*o,r):(t[0]*=-o,t[1]*=-o,t[2]*=-o,t[3]*=o,t)},l.conjugate=function(t,r){return r&&t!==r?(r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r[3]=t[3],r):(t[0]*=-1,t[1]*=-1,t[2]*=-1,t)},l.length=function(t){var r=t[0],n=t[1],e=t[2],a=t[3];return Math.sqrt(r*r+n*n+e*e+a*a)},l.normalize=function(t,r){r||(r=t);var n=t[0],e=t[1],a=t[2],u=t[3],i=Math.sqrt(n*n+e*e+a*a+u*u);return 0===i?(r[0]=0,r[1]=0,r[2]=0,r[3]=0,r):(i=1/i,r[0]=n*i,r[1]=e*i,r[2]=a*i,r[3]=u*i,r)},l.add=function(t,r,n){return n&&t!==n?(n[0]=t[0]+r[0],n[1]=t[1]+r[1],n[2]=t[2]+r[2],n[3]=t[3]+r[3],n):(t[0]+=r[0],t[1]+=r[1],t[2]+=r[2],t[3]+=r[3],t)},l.multiply=function(t,r,n){n||(n=t);var e=t[0],a=t[1],u=t[2],i=t[3],o=r[0],c=r[1],f=r[2],s=r[3];return n[0]=e*s+i*o+a*f-u*c,n[1]=a*s+i*c+u*o-e*f,n[2]=u*s+i*f+e*c-a*o,n[3]=i*s-e*o-a*c-u*f,n},l.multiplyVec3=function(t,r,n){n||(n=r);var e=r[0],a=r[1],u=r[2],i=t[0],o=t[1],c=t[2],f=t[3],s=f*e+o*u-c*a,v=f*a+c*e-i*u,M=f*u+i*a-o*e,h=-i*e-o*a-c*u;return n[0]=s*f+h*-i+v*-c-M*-o,n[1]=v*f+h*-o+M*-i-s*-c,n[2]=M*f+h*-c+s*-o-v*-i,n},l.scale=function(t,r,n){return n&&t!==n?(n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n[3]=t[3]*r,n):(t[0]*=r,t[1]*=r,t[2]*=r,t[3]*=r,t)},l.toMat3=function(t,r){r||(r=M.create());var n=t[0],e=t[1],a=t[2],u=t[3],i=n+n,o=e+e,c=a+a,f=n*i,s=n*o,v=n*c,h=e*o,l=e*c,m=a*c,b=u*i,y=u*o,d=u*c;return r[0]=1-(h+m),r[1]=s+d,r[2]=v-y,r[3]=s-d,r[4]=1-(f+m),r[5]=l+b,r[6]=v+y,r[7]=l-b,r[8]=1-(f+h),r},l.toMat4=function(t,r){r||(r=h.create());var n=t[0],e=t[1],a=t[2],u=t[3],i=n+n,o=e+e,c=a+a,f=n*i,s=n*o,v=n*c,M=e*o,l=e*c,m=a*c,b=u*i,y=u*o,d=u*c;return r[0]=1-(M+m),r[1]=s+d,r[2]=v-y,r[3]=0,r[4]=s-d,r[5]=1-(f+m),r[6]=l+b,r[7]=0,r[8]=v+y,r[9]=l-b,r[10]=1-(f+M),r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},l.slerp=function(t,r,n,e){e||(e=t);var a,u,i,o,c=t[0]*r[0]+t[1]*r[1]+t[2]*r[2]+t[3]*r[3];return Math.abs(c)>=1?(e!==t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]),e):(a=Math.acos(c),u=Math.sqrt(1-c*c),Math.abs(u)<.001?(e[0]=.5*t[0]+.5*r[0],e[1]=.5*t[1]+.5*r[1],e[2]=.5*t[2]+.5*r[2],e[3]=.5*t[3]+.5*r[3],e):(i=Math.sin((1-n)*a)/u,o=Math.sin(n*a)/u,e[0]=t[0]*i+r[0]*o,e[1]=t[1]*i+r[1]*o,e[2]=t[2]*i+r[2]*o,e[3]=t[3]*i+r[3]*o,e))},l.fromRotationMatrix=function(t,r){r||(r=l.create());var n,e=t[0]+t[4]+t[8];if(e>0)n=Math.sqrt(e+1),r[3]=.5*n,n=.5/n,r[0]=(t[7]-t[5])*n,r[1]=(t[2]-t[6])*n,r[2]=(t[3]-t[1])*n;else{var a=l.fromRotationMatrix.s_iNext=l.fromRotationMatrix.s_iNext||[1,2,0],u=0;t[4]>t[0]&&(u=1),t[8]>t[3*u+u]&&(u=2);var i=a[u],o=a[i];n=Math.sqrt(t[3*u+u]-t[3*i+i]-t[3*o+o]+1),r[u]=.5*n,n=.5/n,r[3]=(t[3*o+i]-t[3*i+o])*n,r[i]=(t[3*i+u]+t[3*u+i])*n,r[o]=(t[3*o+u]+t[3*u+o])*n}return r},M.toQuat4=l.fromRotationMatrix,function(){var t=M.create();l.fromAxes=function(r,n,e,a){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=e[0],t[4]=e[1],t[7]=e[2],t[2]=r[0],t[5]=r[1],t[8]=r[2],l.fromRotationMatrix(t,a)}}(),l.identity=function(t){return t||(t=l.create()),t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},l.fromAngleAxis=function(t,r,n){n||(n=l.create());var e=.5*t,a=Math.sin(e);return n[3]=Math.cos(e),n[0]=a*r[0],n[1]=a*r[1],n[2]=a*r[2],n},l.toAngleAxis=function(t,r){r||(r=t);var n=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(n>0){r[3]=2*Math.acos(t[3]);var a=e.invsqrt(n);r[0]=t[0]*a,r[1]=t[1]*a,r[2]=t[2]*a}else r[3]=0,r[0]=1,r[1]=0,r[2]=0;return r},l.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+"]"};var b={};b.create=function(t){var r=new a(2);return t?(r[0]=t[0],r[1]=t[1]):(r[0]=0,r[1]=0),r},b.createFrom=function(t,r){var n=new a(2);return n[0]=t,n[1]=r,n},b.add=function(t,r,n){return n||(n=r),n[0]=t[0]+r[0],n[1]=t[1]+r[1],n},b.subtract=function(t,r,n){return n||(n=r),n[0]=t[0]-r[0],n[1]=t[1]-r[1],n},b.multiply=function(t,r,n){return n||(n=r),n[0]=t[0]*r[0],n[1]=t[1]*r[1],n},b.divide=function(t,r,n){return n||(n=r),n[0]=t[0]/r[0],n[1]=t[1]/r[1],n},b.scale=function(t,r,n){return n||(n=t),n[0]=t[0]*r,n[1]=t[1]*r,n},b.dist=function(t,r){var n=r[0]-t[0],e=r[1]-t[1];return Math.sqrt(n*n+e*e)},b.set=function(t,r){return r[0]=t[0],r[1]=t[1],r},b.equal=function(t,r){return t===r||Math.abs(t[0]-r[0])<1e-6&&Math.abs(t[1]-r[1])<1e-6},b.negate=function(t,r){return r||(r=t),r[0]=-t[0],r[1]=-t[1],r},b.normalize=function(t,r){r||(r=t);var n=t[0]*t[0]+t[1]*t[1];return n>0?(n=Math.sqrt(n),r[0]=t[0]/n,r[1]=t[1]/n):r[0]=r[1]=0,r},b.cross=function(t,r,n){var e=t[0]*r[1]-t[1]*r[0];return n?(n[0]=n[1]=0,n[2]=e,n):e},b.length=function(t){var r=t[0],n=t[1];return Math.sqrt(r*r+n*n)},b.squaredLength=function(t){var r=t[0],n=t[1];return r*r+n*n},b.dot=function(t,r){return t[0]*r[0]+t[1]*r[1]},b.direction=function(t,r,n){n||(n=t);var e=t[0]-r[0],a=t[1]-r[1],u=e*e+a*a;return u?(u=1/Math.sqrt(u),n[0]=e*u,n[1]=a*u,n):(n[0]=0,n[1]=0,n[2]=0,n)},b.lerp=function(t,r,n,e){return e||(e=t),e[0]=t[0]+n*(r[0]-t[0]),e[1]=t[1]+n*(r[1]-t[1]),e},b.str=function(t){return"["+t[0]+", "+t[1]+"]"};var y={};y.create=function(t){var r=new a(4);return t?(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3]):r[0]=r[1]=r[2]=r[3]=0,r},y.createFrom=function(t,r,n,e){var u=new a(4);return u[0]=t,u[1]=r,u[2]=n,u[3]=e,u},y.set=function(t,r){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r},y.equal=function(t,r){return t===r||Math.abs(t[0]-r[0])<1e-6&&Math.abs(t[1]-r[1])<1e-6&&Math.abs(t[2]-r[2])<1e-6&&Math.abs(t[3]-r[3])<1e-6},y.identity=function(t){return t||(t=y.create()),t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},y.transpose=function(t,r){if(!r||t===r){var n=t[1];return t[1]=t[2],t[2]=n,t}return r[0]=t[0],r[1]=t[2],r[2]=t[1],r[3]=t[3],r},y.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},y.inverse=function(t,r){r||(r=t);var n=t[0],e=t[1],a=t[2],u=t[3],i=n*u-a*e;return i?(i=1/i,r[0]=u*i,r[1]=-e*i,r[2]=-a*i,r[3]=n*i,r):null},y.multiply=function(t,r,n){n||(n=t);var e=t[0],a=t[1],u=t[2],i=t[3];return n[0]=e*r[0]+a*r[2],n[1]=e*r[1]+a*r[3],n[2]=u*r[0]+i*r[2],n[3]=u*r[1]+i*r[3],n},y.rotate=function(t,r,n){n||(n=t);var e=t[0],a=t[1],u=t[2],i=t[3],o=Math.sin(r),c=Math.cos(r);return n[0]=e*c+a*o,n[1]=e*-o+a*c,n[2]=u*c+i*o,n[3]=u*-o+i*c,n},y.multiplyVec2=function(t,r,n){n||(n=r);var e=r[0],a=r[1];return n[0]=e*t[0]+a*t[1],n[1]=e*t[2]+a*t[3],n},y.scale=function(t,r,n){n||(n=t);var e=t[0],a=t[1],u=t[2],i=t[3],o=r[0],c=r[1];return n[0]=e*o,n[1]=a*c,n[2]=u*o,n[3]=i*c,n},y.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+"]"};var d={};return d.create=function(t){var r=new a(4);return t?(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3]):(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r},d.createFrom=function(t,r,n,e){var u=new a(4);return u[0]=t,u[1]=r,u[2]=n,u[3]=e,u},d.add=function(t,r,n){return n||(n=r),n[0]=t[0]+r[0],n[1]=t[1]+r[1],n[2]=t[2]+r[2],n[3]=t[3]+r[3],n},d.subtract=function(t,r,n){return n||(n=r),n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],n[3]=t[3]-r[3],n},d.multiply=function(t,r,n){return n||(n=r),n[0]=t[0]*r[0],n[1]=t[1]*r[1],n[2]=t[2]*r[2],n[3]=t[3]*r[3],n},d.divide=function(t,r,n){return n||(n=r),n[0]=t[0]/r[0],n[1]=t[1]/r[1],n[2]=t[2]/r[2],n[3]=t[3]/r[3],n},d.scale=function(t,r,n){return n||(n=t),n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n[3]=t[3]*r,n},d.set=function(t,r){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r},d.equal=function(t,r){return t===r||Math.abs(t[0]-r[0])<1e-6&&Math.abs(t[1]-r[1])<1e-6&&Math.abs(t[2]-r[2])<1e-6&&Math.abs(t[3]-r[3])<1e-6},d.negate=function(t,r){return r||(r=t),r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r[3]=-t[3],r},d.length=function(t){var r=t[0],n=t[1],e=t[2],a=t[3];return Math.sqrt(r*r+n*n+e*e+a*a)},d.squaredLength=function(t){var r=t[0],n=t[1],e=t[2],a=t[3];return r*r+n*n+e*e+a*a},d.lerp=function(t,r,n,e){return e||(e=t),e[0]=t[0]+n*(r[0]-t[0]),e[1]=t[1]+n*(r[1]-t[1]),e[2]=t[2]+n*(r[2]-t[2]),e[3]=t[3]+n*(r[3]-t[3]),e},d.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+"]"},t&&(t.glMatrixArrayType=a,t.MatrixArray=a,t.setMatrixArrayType=r,t.determineMatrixArrayType=n,t.glMath=e,t.vec2=b,t.vec3=u,t.vec4=d,t.mat2=y,t.mat3=M,t.mat4=h,t.quat4=l),{glMatrixArrayType:a,MatrixArray:a,setMatrixArrayType:r,determineMatrixArrayType:n,glMath:e,vec2:b,vec3:u,vec4:d,mat2:y,mat3:M,mat4:h,quat4:l}});
